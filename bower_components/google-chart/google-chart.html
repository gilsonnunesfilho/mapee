<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-ajax/iron-request.html"><link rel="import" href="google-chart-loader.html"><link rel="import" href="google-chart-styles.html"></head><body><dom-module id="google-chart"><template><style include="google-chart-styles"></style><google-chart-loader id="loader" type="[[type]]"></google-chart-loader><div id="chartdiv"></div></template></dom-module><script>(function(){"use strict";Polymer({is:"google-chart",properties:{type:{type:String,value:"column",observer:"_typeChanged"},events:{type:Array,value:function(){return[]}},options:{type:Object},cols:{type:Array,observer:"_rowsOrColumnsChanged"},rows:{type:Array,observer:"_rowsOrColumnsChanged"},data:{type:String,observer:"_dataChanged"},view:{type:Object,observer:"_viewChanged"},selection:{type:Array,notify:!0,observer:"_setSelection"},drawn:{type:Boolean,readOnly:!0,value:!1}},observers:["_draw(_chart, _dataView)","_subOptionChanged(options.*)"],listeners:{"google-chart-select":"_updateSelection","google-chart-ready":"_onChartReady"},_chart:null,_dataView:null,_selection:null,_typeChanged:function(){this.$.loader.create(this.type,this.$.chartdiv).then(function(chart){var loader=this.$.loader;Object.keys(this.events.concat(["select","ready"]).reduce(function(set,eventName){set[eventName]=!0;return set},{})).forEach(function(eventName){loader.fireOnChartEvent(chart,eventName)});this._setDrawn(!1);this._chart=chart}.bind(this))},_subOptionChanged:function(optionChangeDetails){this.options=optionChangeDetails.base;this.debounce("optionChangeRedraw",function(){this.redraw()},5)},_setSelection:function(){if(!this.drawn||!this.selection||this.selection===this._selection){return}if(this._chart.setSelection){this._chart.setSelection(this.selection)}this._selection=this.selection},_updateSelection:function(){this.selection=this._selection=this._chart.getSelection()},_onChartReady:function(){this._setDrawn(!0);this._selection=null;this._setSelection()},redraw:function(){if(!this._chart||!this._dataView){return}this._draw(this._chart,this._dataView)},_draw:function(chart,data){if(null==chart||null==data){return}try{this._setDrawn(!1);chart.draw(data,this.options||{})}catch(error){this.$.chartdiv.innerHTML=error}},get imageURI(){if(!this._chart){return null}return this._chart.getImageURI()},_viewChanged:function(view){if(!view){return}this._dataView=view},_rowsOrColumnsChanged:function(){var rows=this.rows,cols=this.cols;if(!rows||!cols){return}this.$.loader.dataTable().then(function(dataTable){cols.forEach(function(col){dataTable.addColumn(col)});dataTable.addRows(rows);return dataTable}.bind(this)).then(this.$.loader.dataView.bind(this.$.loader)).then(function(dataView){this._dataView=dataView}.bind(this)).catch(function(reason){this.$.chartdiv.innerHTML=reason}.bind(this))},_dataChanged:function(data){var dataPromise;if(!data){return}var isString=!1;try{data=JSON.parse(data)}catch(e){isString="string"==typeof data||data instanceof String}if(isString){var request=document.createElement("iron-request");dataPromise=request.send({url:data,handleAs:"json"}).then(function(xhr){return xhr.response})}else{dataPromise=Promise.resolve(data)}dataPromise.then(this.$.loader.dataTable.bind(this.$.loader)).then(this.$.loader.dataView.bind(this.$.loader)).then(function(dataView){this._dataView=dataView}.bind(this))}})})();</script></body></html>