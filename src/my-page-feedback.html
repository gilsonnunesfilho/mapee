<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/paper-card/paper-card.html"><link rel="import" href="../bower_components/paper-input/paper-input.html"><link rel="import" href="../bower_components/paper-input/paper-textarea.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/iron-form/iron-form.html"><link rel="import" href="../bower_components/iron-icon/iron-icon.html"><link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../bower_components/app-route/app-route.html"><link rel="import" href="../bower_components/app-storage/app-localstorage/app-localstorage-document.html"><link rel="import" href="shared-styles.html"></head><body><dom-module id="my-page-feedback"><template><style include="shared-styles">:host{display:block;}paper-card{width:100%;}paper-button{@apply --paper-font-button;background-color:var(--accent-color);color:white;margin:0;}.card-content{padding:16px 24px;box-sizing:border-box;}.card-content>p{margin-top:0;}.card-actions{padding:24px;margin-top:16px;box-sizing:border-box;}.error{padding-top:1em;box-sizing:border-box;display:flex;align-items:center;color:var(--paper-red-a200);}.error iron-icon{margin-right:.5em;}.error p{@apply --paper-font-body1;}</style><app-route route="{{route}}" pattern="feedback" data="{{routeData}}" active="{{currentPage}}"></app-route><h2>Formulário de contato</h2><paper-card><iron-form id="form" on-iron-form-presubmit="submitForm"><form action=""><div class="card-content"><p>Obrigado por dedicar seu tempo para falar conosco, seu feedback é muito importante para manter uma melhora crescente. Sinta-se livre para enviar elogios, críticas e/ou sugestões:</p><template is="dom-if" if="[[_isMsg]]"><span class$="paper-font-caption [[_msgColor]]-color">[[_msgContent]]</span></template><paper-textarea name="message" char-counter="" required="" autocorrect="" autofocus="" label="Mensagem" value="{{text}}"></paper-textarea></div><div class="card-actions"><paper-button raised="" on-click="_submit">Enviar feedback</paper-button></div></form></iron-form></paper-card><iron-ajax id="feedback_ajax" url="[[apiURL]]/feedback" content-type="application/json" handle-as="json" method="POST" on-response="handleResponse"></iron-ajax></template><script>class MyPageFeedback extends Polymer.Element{static get is(){return"my-page-feedback"}static get properties(){return{text:{type:String},_isMsg:{type:Boolean,value:!1},_msgColor:{type:String,value:"warning"},_msgContent:String,apiURL:{type:String,readOnly:!0,value(){return window.apiURL}},route:{type:String,notify:!0},routeData:{type:Object,notify:!0},currentPage:{type:Boolean,value:!1}}}static get observers(){return["_pageChange(currentPage)"]}_pageChange(active){if(active){window.dispatchEvent(new CustomEvent("page-response",{detail:{drawerOpen:!0,title:"Feedback"}}))}}_submit(){this.$.form.submit()}submitForm(e){e.preventDefault();window.getTransactionMapeeUser(!0).store.getAll().onsuccess=ev=>{let user=ev.target.result[0];if(user&&user.apiKey){this.$.feedback_ajax.body={key:user.apiKey,text:this.text};this.$.feedback_ajax.generateRequest()}}}handleResponse(e){let result=e.detail.response;if(result.success){this.sendWarning("Enviado com sucesso!")}else{this.sendError("Mensagem n\xE3o pode ser enviada!");console.log(result)}}sendError(eMsg){this._isMsg=!0;this._msgColor="error";this._msgContent=eMsg}sendWarning(eMsg){this._isMsg=!0;this._msgColor="warning";this._msgContent=eMsg}}window.customElements.define(MyPageFeedback.is,MyPageFeedback);</script></dom-module></body></html>