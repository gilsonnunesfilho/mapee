<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/paper-input/paper-input.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/paper-card/paper-card.html"><link rel="import" href="../bower_components/paper-styles/typography.html"><link rel="import" href="../bower_components/iron-a11y-keys/iron-a11y-keys.html"><link rel="import" href="../bower_components/iron-form/iron-form.html"><link rel="import" href="../bower_components/app-route/app-route.html"><link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../bower_components/iron-icon/iron-icon.html"><link rel="import" href="../bower_components/fluido-paper-login/fluido-paper-login-icons.html"><link rel="import" href="shared-styles.html"><link rel="import" href="my-icons.html"></head><body><dom-module id="my-page-password-recovery"><template><style include="shared-styles">:host{display:flex;justify-content:center;align-items:center;min-height:calc(100vh - 19em);}paper-card{width:100%;}paper-progress{width:100%;--paper-progress-container-color:transparent;--paper-progress-active-color:var(--primary-color);}header{@apply --paper-font-headline;}iron-icon{color:var(--secondary-text-color, #737373);}paper-input[focused] iron-icon{color:var(--primary-color);}paper-button{@apply --paper-font-button;}paper-button[raised]{background-color:var(--primary-color);color:white;margin:1em;width:calc(100% - 2em);}</style><app-route route="{{route}}" pattern="recovery" data="{{routeData}}" active="{{currentPage}}"></app-route><iron-form id="form" on-iron-form-presubmit="recoveryClick"><form action=""><paper-card><div class="card-content"><header><h2>Recuperar sua senha</h2></header><template is="dom-if" if="[[_isMsg]]"><span class$="paper-font-caption [[_msgColor]]-color">[[_msgContent]]</span></template><paper-input type="password" label="Nova senha" required="" value="{{password}}"><iron-icon icon="fluido-paper-login-icons:lock" slot="suffix"></iron-icon></paper-input><paper-input type="password" label="Repetir nova senha" required="" value="{{cpassword}}" disabled="[[_passConfirm]]"><iron-icon icon="fluido-paper-login-icons:lock-outline" slot="suffix"></iron-icon></paper-input></div><div class="vertical justified"><paper-button raised="" on-click="_submit">Enviar</paper-button></div></paper-card><iron-a11y-keys keys="enter" on-keys-pressed="_submit"></iron-a11y-keys></form></iron-form><iron-ajax id="recovery_ajax" url="[[apiURL]]/account/recovery" content-type="application/json" handle-as="json" method="POST" on-response="handleRecovery"></iron-ajax></template><script>class MyPagePasswordRecovery extends Polymer.Element{static get is(){return"my-page-password-recovery"}static get properties(){return{token:{type:String},password:{type:String,observer:"_computePassEmpty"},cpassword:{type:String},_passConfirm:{type:Boolean,value:!0},_isMsg:{type:Boolean,value:!1},_msgColor:{type:String,value:"warning"},_msgContent:String,apiURL:{type:String,readOnly:!0,value(){return window.apiURL}},route:{type:String,notify:!0},routeData:{type:Object,notify:!0},currentPage:{type:Boolean,observer:"_pageChange",value:!1}}}ready(){super.ready();window.addEventListener("page-change",e=>{let result=e.detail;if("recovery"==result.page){this.recoveryToken();window.dispatchEvent(new CustomEvent("page-response",{detail:{title:"Recuperar senha"}}))}})}_pageChange(active){if(active){this.recoveryToken();window.dispatchEvent(new CustomEvent("page-response",{detail:{title:"Recuperar senha"}}))}}recoveryToken(){let query=window.location.search,token=query.match(/token=([a-z0-9]{32,32})/);if(token){this.token=token[1]}}_submit(){this.$.form.submit()}recoveryClick(e){e.preventDefault();if(!this.token)return this.sendError("Token Incorreto!");if(this.password!==this.cpassword)return this.sendError("Senhas n\xE3o combinam!");this.$.recovery_ajax.body={token:this.token,password:this.password,cpassword:this.cpassword};this.$.recovery_ajax.generateRequest()}handleRecovery(e){let result=e.detail.response;if(result.success){this.sendWarning("Senha redifinida com sucesso!");setTimeout(()=>{window.location.href="/login"},2e3)}else{this.sendError("Senha n\xE3o pode ser redefinida!");console.log(result)}}sendError(eMsg){this._isMsg=!0;this._msgColor="error";this._msgContent=eMsg}sendWarning(eMsg){this._isMsg=!0;this._msgColor="warning";this._msgContent=eMsg}_computePassEmpty(password){if(!password){this._passConfirm=!0}else{this._passConfirm=!1}}}window.customElements.define(MyPagePasswordRecovery.is,MyPagePasswordRecovery);</script></dom-module></body></html>