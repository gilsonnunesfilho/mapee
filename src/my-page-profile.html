<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html"><link rel="import" href="../bower_components/iron-form/iron-form.html"><link rel="import" href="../bower_components/app-route/app-route.html"><link rel="import" href="../bower_components/app-storage/app-localstorage/app-localstorage-document.html"><link rel="import" href="../bower_components/fluido-expansion-panel/fluido-expansion-panels.html"></head><body><dom-module id="my-page-profile"><template><style include="shared-styles">:host{display:block;}</style><app-route route="{{route}}" pattern="perfil" data="{{routeData}}" active="{{currentPage}}"></app-route><h2>Suas informações</h2><fluido-expansion-panels accordion=""><fluido-expansion-panel panel-title="Informações de acesso" panel-description="Mudar senha" expanded=""><iron-form id="form_access" on-iron-form-presubmit="submitAccess"><form action=""><paper-input label="Insira uma nova senha" type="password" value="{{access.password}}"></paper-input><paper-input label="Digite a nova senha novamente" type="password" value="{{access.cpassword}}" disabled="[[_isEmpty(access.password)]]"></paper-input></form></iron-form><div slot="actions"><paper-button on-click="_submitFormAccess">Salvar</paper-button></div></fluido-expansion-panel></fluido-expansion-panels><iron-ajax id="update_ajax" url="[[apiURL]]/account/update" content-type="application/json" handle-as="json" method="POST" on-response="handleResponse"></iron-ajax><iron-ajax id="user_ajax" url="[[apiURL]]/user" content-type="application/json" handle-as="json" method="GET" on-response="handleResponse"></iron-ajax></template><script>class MyPageProfile extends Polymer.Element{static get is(){return"my-page-profile"}static get properties(){return{access:{type:Object,notify:!0,value(){return{}}},me:{type:Object,notify:!0,value(){return{}}},prof:{type:Object,notify:!0,value(){return{}}},user:{type:Object,observer:"changeUserData"},apiURL:{type:String,readOnly:!0,value(){return window.apiURL}},route:{type:String,notify:!0},routeData:{type:Object,notify:!0},currentPage:{type:Boolean,value:!1}}}static get observers(){return["_pageChange(currentPage)"]}_pageChange(active){if(active){window.dispatchEvent(new CustomEvent("page-response",{detail:{drawerOpen:!0,title:"Perfil"}}));this._requestUser()}}_requestUser(){if(navigator.onLine){window.getTransactionMapeeUser(!0).store.getAll().onsuccess=ev=>{let user=ev.target.result[0];if(user&&user.apiKey){this.$.user_ajax.params={key:user.apiKey};this.$.user_ajax.generateRequest()}};window.globalWaiting(!0)}else{this.update()}}update(user){if(user){window.getTransactionMapeeUser().store.put(user).onsuccess=()=>{this.update()}}else{window.getTransactionMapeeUser().store.getAll().onsuccess=ev=>{this.set("user",ev.target.result[0])}}}_isEmpty(e){return!e}_submitFormAccess(){this.$.form_access.submit()}_submitFormMe(){this.$.form_me.submit()}_submitFormProfessional(){this.$.form_prof.submit()}submitAccess(e){e.preventDefault();window.globalWaiting(!0);window.getTransactionMapeeUser(!0).store.getAll().onsuccess=ev=>{let user=ev.target.result[0];if(user&&user.apiKey){this.$.update_ajax.body=this.access;this.$.update_ajax.body.key=user.apiKey;this.$.update_ajax.generateRequest()}}}submitMe(e){e.preventDefault();window.globalWaiting(!0);window.getTransactionMapeeUser(!0).store.getAll().onsuccess=ev=>{let user=ev.target.result[0];if(user&&user.apiKey){this.$.update_ajax.body=this.me;this.$.update_ajax.body.key=user.apiKey;this.$.update_ajax.generateRequest()}}}submitProf(e){e.preventDefault();window.globalWaiting(!0);window.getTransactionMapeeUser(!0).store.getAll().onsuccess=ev=>{let user=ev.target.result[0];if(user&&user.apiKey){this.$.update_ajax.body=this.prof;this.$.update_ajax.body.key=user.apiKey;this.$.update_ajax.generateRequest()}}}handleResponse(e){window.globalWaiting(!1);let result=e.detail.response;if(result){this.update(result)}else{console.log(result)}}changeUserData(u){if(u){if(!u.extraData)u.extraData={};this.set("access",{});this.set("me",{name:u.name,phone:u.phone,site:u.extraData.site,linkedin:u.extraData.linkedin});this.set("prof",{formation:u.extraData.formation,specialization:u.extraData.specialization,occupationArea:u.extraData.occupationArea,mapeeQuestionsWorked:u.extraData.mapeeQuestionsWorked,focusInServicesOrProducts:u.extraData.focusInServicesOrProducts,segment:u.extraData.segment,cnae:u.extraData.cnae,geographicalArea:u.extraData.geographicalArea,professionalLink:u.extraData.professionalLink})}}}window.customElements.define(MyPageProfile.is,MyPageProfile);</script></dom-module></body></html>