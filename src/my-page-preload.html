<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/app-route/app-route.html"><link rel="import" href="../bower_components/paper-spinner/paper-spinner-lite.html"></head><body><dom-module id="my-page-preload"><template><style include="shared-styles">:host{display:flex;justify-content:center;align-items:center;min-height:calc(100vh - 224px);box-sizing:border-box;}paper-spinner-lite{width:200px;height:200px;--paper-spinner-stroke-width:24px;--paper-spinner-color:var(--accent-color);}iron-icon{color:var(--light-theme-secondary-color);}</style><app-route route="{{route}}" pattern=":page" data="{{routeData}}"></app-route><paper-spinner-lite active=""></paper-spinner-lite></template><script>class MyPagePreload extends Polymer.Element{static get is(){return"my-page-preload"}static get properties(){return{apiURL:{type:String,readOnly:!0,value(){return window.apiURL}},route:{type:String,notify:!0},routeData:{type:Object,notify:!0}}}static get observers(){return[]}ready(){super.ready();this.load=!1;window.setConstProperty(window,"IdexedMapeeDataBase",window.indexedDB.open("MapeeDataBase",3));window.IdexedMapeeDataBase.onupgradeneeded=this.upgradeDB.bind(this);window.IdexedMapeeDataBase.onsuccess=this.successDB.bind(this)}upgradeDB(ev){if(!window.MapeeDB)window.setConstProperty(window,"MapeeDB",ev.target.result);let userStore=window.MapeeDB.createObjectStore("MapeeUser",{keyPath:"_id"});userStore.createIndex("MapeeUserEmail","email",{unique:!0});userStore.createIndex("MapeeUserApiKey","apiKey",{unique:!0});window.MapeeDB.createObjectStore("MapeeDiag",{keyPath:"_id"})}successDB(ev){if(!window.MapeeDB)window.setConstProperty(window,"MapeeDB",ev.target.result);window.setConstProperty(window,"getTransactionMapeeUser",readOnly=>{let read=readOnly?"readonly":"readwrite",res={},tx=window.MapeeDB.transaction("MapeeUser",read);res.store=tx.objectStore("MapeeUser");res.indexEmail=res.store.index("MapeeUserEmail");res.indexApiKey=res.store.index("MapeeUserApiKey");return res});window.setConstProperty(window,"getTransactionMapeeDiag",readOnly=>{let read=readOnly?"readonly":"readwrite",res={},tx=window.MapeeDB.transaction("MapeeDiag",read);res.store=tx.objectStore("MapeeDiag");return res});let txUser=window.getTransactionMapeeUser(!0);txUser.store.count().onsuccess=ev=>{if(ev.target.result){this.triggerLogged()}else{this.triggerNotLogged()}}}triggerNotLogged(){this.load=!0;console.log(this.routeData.page);if(!["login","recovery"].includes(this.routeData.page))window.setLocation("login",!0)}triggerLogged(){this.load=!0;if("login"==this.routeData.page)window.setLocation("painel_de_controle",!0)}}window.customElements.define(MyPagePreload.is,MyPagePreload);</script></dom-module></body></html>